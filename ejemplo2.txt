SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [ADM].[SP_INSERTA_BITACORA_OPERACIONES] 
	@PIN_ID_CONTRATO INT,
	@PIN_CL_CUENTA NVARCHAR(30),
	@PIN_CL_BITACORA NVARCHAR(50),
	@PIN_DS_BITACORA NVARCHAR(250),
	@PIN_XML_DATOS_ADICIONALES XML,
	@PIN_CL_USUARIO_BITACORA NVARCHAR(50),
	@PIN_CL_USUARIO NVARCHAR(50),
	@PIN_NB_PROGRAMA NVARCHAR(50),
	@POUT_FG_RETORNO INT OUT
AS
BEGIN
	SET @POUT_FG_RETORNO = 0
	IF(@PIN_ID_CONTRATO IS NULL OR @PIN_CL_CUENTA IS NULL)
	BEGIN
		SELECT @PIN_ID_CONTRATO = ID_CONTRATO, @PIN_CL_CUENTA = CL_CUENTA FROM PDC.M_CONTRATO WHERE CL_CUENTA = @PIN_CL_CUENTA OR ID_CONTRATO = @PIN_ID_CONTRATO
	END

	DECLARE @V_FECHA DATETIME = GETDATE()

	INSERT INTO ADM.K_BITACORA (ID_CONTRATO, CL_CUENTA, CL_BITACORA, DS_BITACORA, FE_BITACORA,
								XML_DATOS_ADICIONALES, CL_USUARIO_BITACORA,
								FE_CREACION, CL_USUARIO_APP_CREA, NB_PROGRAMA_CREA)
	VALUES (@PIN_ID_CONTRATO, @PIN_CL_CUENTA, @PIN_CL_BITACORA, @PIN_DS_BITACORA, @V_FECHA,
			@PIN_XML_DATOS_ADICIONALES, @PIN_CL_USUARIO_BITACORA,
			@V_FECHA, @PIN_CL_USUARIO, @PIN_NB_PROGRAMA)

	SET @POUT_FG_RETORNO = 1
END
